<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Juegos - Admin</title>
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ†Ô∏è</text></svg>">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- IMPORTANTE: Supabase debe cargarse antes que tus scripts modulares -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header>
        <h1>üéÆ Creador de Juegos de Escape</h1>
    </header>

    <main>
        <!-- SECCI√ìN 1: LISTA DE JUEGOS -->
        <section id="game-list-section" class="admin-section">
            <h2>Tus Juegos Creados</h2>
            <button id="create-game-btn" class="main-action-button">Crear Nuevo Juego</button>
            <div id="game-list">
                <p>Cargando juegos...</p>
            </div>
            <div id="rankings-summary" class="hidden">
                <h3>Rankings del Juego</h3>
                <div id="rankings-container"></div>
            </div>
        </section>

        <!-- SECCI√ìN 2: FORMULARIO DE JUEGO -->
        <section id="game-form-section" class="admin-section hidden">
            <h2 id="game-form-title"></h2>
            <form id="game-form">
                <label for="game-name-input">Nombre del Juego:</label>
                <input type="text" id="game-name-input" required>
                <label for="adventure-type-input">Tipo de Aventura:</label>
                <select id="adventure-type-input">
                    <option value="linear">Lineal</option>
                    <option value="selectable-paths">Caminos Seleccionables</option>
                </select>
                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Juego</button>
                    <button type="button" id="cancel-game-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>

        <!-- SECCI√ìN 3: LISTA DE UBICACIONES -->
        <section id="location-list-section" class="admin-section hidden">
            <h2 id="game-name-header"></h2>
            <div class="header-actions">
                <button id="add-location-btn" class="main-action-button">A√±adir Nueva Ubicaci√≥n</button>
                <button id="back-to-games-btn" class="back-button">Volver a Juegos</button>
                <button id="preview-game-btn" class="secondary-action-button">Previsualizar</button>
            </div>
            <div id="location-list">
                <p>Cargando ubicaciones...</p>
            </div>
        </section>

        <!-- SECCI√ìN 4: FORMULARIO DE UBICACI√ìN -->
        <section id="location-form-section" class="admin-section hidden">
            <h2 id="location-form-title"></h2>
            <form id="location-form">
                <label for="location-name-input">Nombre de la Ubicaci√≥n:</label>
                <input type="text" id="location-name-input" required>
                <label for="location-lat-input">Latitud:</label>
                <input type="number" id="location-lat-input" step="any" required>
                <label for="location-lng-input">Longitud:</label>
                <input type="number" id="location-lng-input" step="any" required>
                <label for="location-radius-input">Radio de la Ubicaci√≥n (metros):</label>
                <input type="number" id="location-radius-input" required>
                <label for="location-order-input">Orden (opcional):</label>
                <input type="number" id="location-order-input">
                <div class="map-controls">
                    <button type="button" id="getCurrentLocationBtn" class="secondary-action-button">Usar Ubicaci√≥n Actual</button>
                </div>
                <div id="location-map" style="height: 300px;"></div>
                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Ubicaci√≥n</button>
                    <button type="button" id="cancel-location-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>

        <!-- SECCI√ìN 5: LISTA DE PRUEBAS -->
        <section id="trial-list-section" class="admin-section hidden">
            <h2 id="location-name-header"></h2>
            <div class="header-actions">
                <button id="add-trial-btn" class="main-action-button">A√±adir Nueva Prueba</button>
                <button id="back-to-locations-btn" class="back-button">Volver a Ubicaciones</button>
            </div>
            <div id="trial-list">
                <p>Cargando pruebas...</p>
            </div>
        </section>

        <!-- SECCI√ìN 6: FORMULARIO DE PRUEBA -->
        <section id="trial-form-section" class="admin-section hidden">
            <h2 id="trial-form-title"></h2>
            <form id="trial-form">
                <label for="trial-type-input">Tipo de Prueba:</label>
                <select id="trial-type-input">
                    <option value="text">Respuesta de Texto</option>
                    <option value="numeric">Respuesta Num√©rica</option>
                    <option value="multiple-choice">Opciones M√∫ltiples</option>
                    <option value="ordering">Ordenaci√≥n</option>
                    <option value="proximity">Proximidad</option>
                </select>

                <label for="trial-question-input">Pregunta:</label>
                <textarea id="trial-question-input" required></textarea>

                <label for="image-hint-input">URL de Pista de Imagen (opcional):</label>
                <input type="url" id="image-hint-input">

                <!-- Campos espec√≠ficos para respuestas de texto y num√©ricas -->
                <div id="single-answer-fields" class="hidden">
                    <label for="correct-answer-input">Respuesta Correcta:</label>
                    <input type="text" id="correct-answer-input">
                    <label for="next-location-id-input">ID de la pr√≥xima ubicaci√≥n (si es lineal):</label>
                    <input type="text" id="next-location-id-input" placeholder="ID de la pr√≥xima ubicaci√≥n">
                </div>

                <!-- Campos para pruebas de opciones m√∫ltiples y ordenaci√≥n -->
                <div id="multiple-options-fields" class="hidden">
                    <label for="text-options">Opciones (separadas por punto y coma ';'):</label>
                    <textarea id="text-options" placeholder="Opci√≥n A;Opci√≥n B;Opci√≥n C"></textarea>
                    <p class="help-text">Las opciones que el jugador ver√° para elegir.</p>
                    
                    <label for="text-correct-answer-multi-ordering">Respuesta Correcta (ej: Opci√≥n B):</label>
                    <input type="text" id="text-correct-answer-multi-ordering">
                    <p class="help-text">Para Opciones M√∫ltiples, la opci√≥n correcta. Para Ordenaci√≥n, el orden correcto de las opciones (ej: A;C;B).</p>
                    
                    <!-- NUEVO: Contenedor para los campos de caminos alternativos -->
                    <div id="multiple-options-paths">
                        <!-- Aqu√≠ se generar√°n din√°micamente los campos -->
                    </div>
                </div>

                <!-- Campos para pruebas de proximidad -->
                <div id="proximity-fields" class="hidden">
                    <label for="proximity-target-input">ID de la prueba de objetivo (si es necesaria):</label>
                    <input type="text" id="proximity-target-input">
                </div>
                
                <label for="trial-order-input">Orden (opcional):</label>
                <input type="number" id="trial-order-input">

                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Prueba</button>
                    <button type="button" id="cancel-trial-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Generador de WebApp de B√∫squeda del Tesoro</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script type="module" src="admin-supabase-config.js"></script>
    <script type="module" src="admin-script.js"></script>
</body>
</html>
