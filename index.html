<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Juegos - Admin</title>
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ†Ô∏è</text></svg>">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
    <header>
        <h1>üéÆ Creador de Juegos de Escape</h1>
    </header>

    <main>
        <section id="game-list-section" class="admin-section">
            <h2>Tus Juegos Creados</h2>
            <button id="create-game-btn" class="main-action-button">Crear Nuevo Juego</button>
            <div id="game-list">
                <p>Cargando juegos...</p>
            </div>
            <div id="rankings-summary" class="hidden">
                <h2>Rankings de Juegos Completados</h2>
                <div id="rankings-container">
                    <p>Cargando rankings...</p>
                </div>
            </div>
        </section>

        <section id="game-form-section" class="admin-section hidden">
            <h2><span id="form-title">Crear Nuevo Juego</span> <span class="game-name-display"></span></h2>
            <form id="game-form">
                <input type="hidden" id="game-id">

                <label for="game-title">T√≠tulo del Juego:</label>
                <input type="text" id="game-title" required>

                <label for="game-description">Descripci√≥n (para el jugador):</label>
                <textarea id="game-description"></textarea>

                <label for="game-mechanics">Mec√°nica (para el jugador):</label>
                <textarea id="game-mechanics"></textarea>

                <label for="game-initial-narrative">Narrativa Inicial del Juego:</label>
                <textarea id="game-initial-narrative"></textarea>

                <label for="game-image-url">URL de Imagen del Juego (opcional):</label>
                <input type="url" id="game-image-url" placeholder="https://ejemplo.com/imagen_juego.jpg">
                <p class="help-text">URL de una imagen que se mostrar√° al inicio del juego.</p>

                <label for="game-audio-url">URL de Audio del Juego (opcional):</label>
                <input type="url" id="game-audio-url" placeholder="https://ejemplo.com/audio_juego.mp3">
                <p class="help-text">URL de un archivo de audio que se reproducir√° con la narrativa inicial.</p>
                <label for="game-adventure-type">Tipo de Aventura:</label>
                <select id="game-adventure-type">
                    <option value="linear">Lineal (Ubicaciones en orden)</option>
                    <option value="selectable">Seleccionable (El jugador elige la ubicaci√≥n)</option>
                </select>

                <label for="game-initial-score-per-trial">Puntuaci√≥n Inicial por Prueba:</label>
                <input type="number" id="game-initial-score-per-trial" value="100" min="1" required>

                <label for="game-is-active">Activar Juego (visible para jugadores):</label>
                <input type="checkbox" id="game-is-active">

                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Juego</button>
                    <button type="button" id="cancel-game-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>

        <section id="location-list-section" class="admin-section hidden">
            <h2>Ubicaciones del Juego: <span id="current-game-name"></span></h2>
            <button id="add-location-btn" class="main-action-button">A√±adir Nueva Ubicaci√≥n</button>
            <div id="location-list">
                <p>Cargando ubicaciones...</p>
            </div>
            <div class="form-actions">
                <button type="button" id="back-to-games-btn" class="back-button">Volver a Juegos</button>
                <button type="button" id="preview-game-btn" class="preview-button">Previsualizar Juego</button>
            </div>
        </section>

        <section id="location-form-section" class="admin-section hidden">
            <h2><span id="location-form-title">Crear Nueva Ubicaci√≥n</span></h2>
            <form id="location-form">
                <input type="hidden" id="location-id">
                <input type="hidden" id="current-game-id-location">

                <label for="location-name">Nombre de la Ubicaci√≥n (ej: Plaza Mayor):</label>
                <input type="text" id="location-name" required>

                <label for="location-order-index">Orden (solo si el juego es lineal):</label>
                <input type="number" id="location-order-index" min="1" value="1">

                <fieldset class="fieldset-map">
                    <legend>Coordenadas de la Ubicaci√≥n</legend>
                    <label for="location-latitude">Latitud:</label>
                    <input type="number" id="location-latitude" step="any" placeholder="Ej: 40.7128" required>
                    <label for="location-longitude">Longitud:</label>
                    <input type="number" id="location-longitude" step="any" placeholder="Ej: -74.0060" required>
                    <label for="location-tolerance">Radio de Tolerancia GPS (metros):</label>
                    <input type="number" id="location-tolerance" min="0" value="10" required>
                    <p class="help-text">El radio de proximidad para que el GPS del jugador detecte la llegada a esta ubicaci√≥n.</p>

                    <div id="location-map" style="height: 300px; width: 100%; margin-top: 15px; border: 1px solid var(--border);"></div>
                    <button type="button" id="get-current-location-btn" class="secondary-action-button">Obtener Ubicaci√≥n Actual</button>
                    <p class="help-text">Haz clic en el mapa para establecer el punto de la ubicaci√≥n o usa tu ubicaci√≥n actual.</p>
                </fieldset>

                <label for="pre-arrival-narrative">Narrativa PRE-LLEGADA (Se muestra ANTES de que el jugador alcance la ubicaci√≥n):</label>
                <textarea id="pre-arrival-narrative"></textarea>
                <p class="help-text">Describe el contexto que lleva al jugador a esta ubicaci√≥n, un desaf√≠o previo, o el inicio del camino hacia ella.</p>


                <label for="location-initial-narrative">Narrativa de INTRODUCCI√ìN de Pruebas (Se muestra al LLEGAR a la ubicaci√≥n):</label>
                <textarea id="location-initial-narrative"></textarea>
                <p class="help-text">Describe el entorno o la narrativa al llegar el jugador a esta ubicaci√≥n (justo antes de ver las pruebas).</p>

                <label for="location-image-url">URL de Imagen (para la ubicaci√≥n - opcional):</label>
                <input type="url" id="location-image-url" placeholder="https://ejemplo.com/imagen_ubicacion.jpg">

                <label for="location-audio-url">URL de Audio (para la ubicaci√≥n - opcional):</label>
                <input type="url" id="location-audio-url" placeholder="https://ejemplo.com/audio_ubicacion.mp3">

                <label for="location-is-selectable-trials">Pruebas Seleccionables en esta Ubicaci√≥n (el jugador elige el orden):</label>
                <input type="checkbox" id="location-is-selectable-trials">
                <p class="help-text">Si est√° activado, el jugador ver√° un listado de pruebas y podr√° elegir cu√°l hacer. Si no, se har√°n en el orden definido.</p>

                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Ubicaci√≥n</button>
                    <button type="button" id="cancel-location-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>

        <section id="trial-list-section" class="admin-section hidden">
            <h2>Pruebas de la Ubicaci√≥n: <span id="current-location-name"></span></h2>
            <button id="add-trial-btn" class="main-action-button">A√±adir Nueva Prueba</button>
            <div id="trial-list">
                <p>Cargando pruebas...</p>
            </div>
            <div class="form-actions">
                <button type="button" id="back-to-locations-btn" class="back-button">Volver a Ubicaciones</button>
            </div>
        </section>

        <section id="trial-form-section" class="admin-section hidden">
            <h2><span id="trial-form-title">Crear Nueva Prueba</span></h2>
            <form id="trial-form">
                <input type="hidden" id="trial-id">
                <input type="hidden" id="current-location-id-trial">

                <label for="trial-type">Tipo de Prueba:</label>
                <select id="trial-type" required>
                    <option value="">Selecciona un tipo</option>
                    <option value="qr">C√≥digo QR</option>
                    <option value="gps">GPS (Llegar a Coordenadas)</option>
                    <option value="text">Pregunta de Texto</option>
                </select>

                <label for="trial-order-index">Orden de la Prueba (solo si no son seleccionables en la ubicaci√≥n):</label>
                <input type="number" id="trial-order-index" min="1" value="1">

                <label for="trial-narrative">Narrativa de la Prueba:</label>
                <textarea id="trial-narrative" required></textarea>
                <p class="help-text">Texto que el jugador leer√° al iniciar esta prueba.</p>

                <label for="trial-image-url">URL de Imagen (para la prueba - opcional):</label>
                <input type="url" id="trial-image-url" placeholder="https://ejemplo.com/imagen_prueba.jpg">

                <label for="trial-audio-url">URL de Audio (para la prueba - opcional):</label>
                <input type="url" id="trial-audio-url" placeholder="https://ejemplo.com/audio_prueba.mp3">

                <label for="trial-hint-count">N√∫mero de Pistas disponibles:</label>
                <input type="number" id="trial-hint-count" min="0" value="3" required>

                <label for="trial-hint-cost">Coste por Pista (puntos):</label>
                <input type="number" id="trial-hint-cost" min="0" value="10" required>

                <div class="hint-fields-container">
                    <h3>Pistas</h3>
                    <label for="hint1">Pista 1:</label>
                    <textarea id="hint1" rows="2"></textarea>
                    <label for="hint2">Pista 2:</label>
                    <textarea id="hint2" rows="2"></textarea>
                    <label for="hint3">Pista 3:</label>
                    <textarea id="hint3" rows="2"></textarea>
                </div>

                <fieldset id="qr-fields" class="hidden">
                    <legend>Configuraci√≥n QR</legend>
                    <label for="qr-content">Contenido del QR esperado:</label>
                    <input type="text" id="qr-content" placeholder="Ej: QR_DESAFIO_1" required>
                    <p class="help-text">El texto exacto que debe contener el c√≥digo QR.</p>
                </fieldset>

                <fieldset id="gps-fields" class="hidden">
                    <legend>Configuraci√≥n GPS</legend>
                    <label for="gps-latitude">Latitud del Objetivo:</label>
                    <input type="number" id="gps-latitude" step="any" placeholder="Ej: 40.7128" required>
                    <label for="gps-longitude">Longitud del Objetivo:</label>
                    <input type="number" id="gps-longitude" step="any" placeholder="Ej: -74.0060" required>
                    <label for="gps-tolerance">Radio de Tolerancia GPS (metros):</label>
                    <input type="number" id="gps-tolerance" min="0" value="5" required>
                    <p class="help-text">El radio de proximidad para que el GPS del jugador detecte la validaci√≥n de esta prueba.</p>
                </fieldset>

                <fieldset id="text-fields" class="hidden">
                    <legend>Configuraci√≥n de Pregunta de Texto</legend>
                    <label for="text-question">Pregunta:</label>
                    <textarea id="text-question" required></textarea>

                    <label for="text-answer-type">Tipo de Respuesta:</label>
                    <select id="text-answer-type">
                        <option value="single_choice">Respuesta de Texto Libre</option>
                        <option value="numeric">Respuesta Num√©rica</option>
                        <option value="multiple_options">M√∫ltiples Opciones</option>
                        </select>

                    <div id="single-numeric-answer-fields">
                        <label for="text-correct-answer-single-numeric">Respuesta Correcta:</label>
                        <input type="text" id="text-correct-answer-single-numeric" placeholder="Ej: Torre Eiffel o 123" required>
                        <p class="help-text">Para texto libre, la respuesta exacta. Para n√∫meros, el n√∫mero exacto. (Insensible a may√∫sculas/min√∫sculas para texto)</p>
                    </div>

                    <div id="multi-ordering-answer-fields" class="hidden">
                        <label for="text-options">Opciones (separadas por ||, ej: Opci√≥n A || Opci√≥n B):</label>
                        <textarea id="text-options" placeholder="Opci√≥n 1 || Opci√≥n 2 || Opci√≥n 3" rows="2"></textarea>
                        <p class="help-text">Para "M√∫ltiples Opciones", la respuesta correcta debe ser una de estas opciones.</p>

                        <label for="text-correct-answer-multi-ordering">Respuesta Correcta:</label>
                        <input type="text" id="text-correct-answer-multi-ordering" placeholder="Ej: Opci√≥n B o 1 || 2 || 3" required>
                        <p class="help-text">Para "M√∫ltiples Opciones", una de las opciones exactas. Para "Ordenaci√≥n", el orden correcto de los IDs (ej: 1 || 3 || 2).</p>
                    </div>
                </fieldset>

                <div class="form-actions">
                    <button type="submit" class="save-button">Guardar Prueba</button>
                    <button type="button" id="cancel-trial-btn" class="cancel-button">Cancelar</button>
                </div>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Creador de Juegos de Escape</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="admin-supabase-config.js"></script>
    <script src="admin-script.js"></script>

</body>
</html>