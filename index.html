<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdventureQuest - Creador de Pruebas</title>
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="admin-supabase-config.js"></script>
    <script src="../shared/utils.js"></script>
</head>
<body>
    <div id="loading-screen" class="screen">
        <div class="loading-content">
            <div class="logo">üõ†Ô∏è Creador AQ</div>
            <div class="loading-spinner"></div>
            <p>Cargando interfaz...</p>
        </div>
    </div>

    <div id="admin-screen" class="screen hidden">
        <header class="main-header">
            <div class="logo">üõ†Ô∏è Creador AdventureQuest</div>
            <nav class="admin-nav">
                <button id="nav-games-btn" class="btn btn-secondary active">Juegos</button>
                <button id="nav-rankings-btn" class="btn btn-secondary">Rankings</button>
            </nav>
        </header>

        <main class="main-content">
            <section id="games-section" class="admin-section">
                <div class="section-header">
                    <h2>Gesti√≥n de Juegos</h2>
                    <button id="create-game-btn" class="btn btn-primary">Crear Nuevo Juego</button>
                </div>
                <div id="games-list" class="card-grid">
                    </div>

                <div id="game-form-container" class="card form-container hidden">
                    <h3><span id="game-form-title">Crear Nuevo Juego</span></h3>
                    <form id="game-form">
                        <div class="form-group">
                            <label for="game-title">T√≠tulo del Juego</label>
                            <input type="text" id="game-title" required>
                        </div>
                        <div class="form-group">
                            <label for="game-description">Descripci√≥n</label>
                            <textarea id="game-description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="game-mechanics">Mec√°nica del Juego</label>
                            <textarea id="game-mechanics" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="game-narrative-intro">Narrativa Inicial</label>
                            <textarea id="game-narrative-intro" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="game-type">Tipo de Juego</label>
                            <select id="game-type">
                                <option value="linear">Lineal (Localizaciones y Pruebas secuenciales)</option>
                                <option value="selectable">Seleccionable (Pruebas dentro de localizaci√≥n seleccionables)</option>
                            </select>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="game-active">
                            <label for="game-active">Juego Activo</label>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Guardar Juego</button>
                            <button type="button" class="btn btn-secondary" id="game-cancel-btn">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div id="locations-section" class="admin-section hidden">
                    <div class="section-header">
                        <button class="btn btn-secondary back-btn" id="back-to-games-btn">‚Üê Volver a Juegos</button>
                        <h2 id="current-game-title"></h2>
                        <button id="add-location-btn" class="btn btn-primary">A√±adir Localizaci√≥n</button>
                    </div>
                    <div id="locations-list" class="card-grid">
                        </div>

                    <div id="location-form-container" class="card form-container hidden">
                        <h3><span id="location-form-title">Crear Nueva Localizaci√≥n</span></h3>
                        <form id="location-form">
                            <div class="form-group">
                                <label for="location-name">Nombre de la Localizaci√≥n</label>
                                <input type="text" id="location-name" required>
                            </div>
                            <div class="form-group">
                                <label for="location-narrative">Narrativa de la Localizaci√≥n</label>
                                <textarea id="location-narrative" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="location-image-url">URL Imagen</label>
                                <input type="url" id="location-image-url" placeholder="URL de la imagen (opcional)">
                            </div>
                            <div class="form-group">
                                <label for="location-audio-url">URL Audio</label>
                                <input type="url" id="location-audio-url" placeholder="URL del audio (opcional)">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Guardar Localizaci√≥n</button>
                                <button type="button" class="btn btn-secondary" id="location-cancel-btn">Cancelar</button>
                            </div>
                        </form>
                    </div>

                    <div id="trials-section" class="admin-section hidden">
                        <div class="section-header">
                            <button class="btn btn-secondary back-btn" id="back-to-locations-btn">‚Üê Volver a Localizaciones</button>
                            <h2 id="current-location-title"></h2>
                            <button id="add-trial-btn" class="btn btn-primary">A√±adir Prueba</button>
                        </div>
                        <div id="trials-list" class="list-container">
                            </div>

                        <div id="trial-form-container" class="card form-container hidden">
                            <h3><span id="trial-form-title">Crear Nueva Prueba</span></h3>
                            <form id="trial-form">
                                <div class="form-group">
                                    <label for="trial-name">T√≠tulo de la Prueba</label>
                                    <input type="text" id="trial-name" required>
                                </div>
                                <div class="form-group">
                                    <label for="trial-narrative">Narrativa de la Prueba</label>
                                    <textarea id="trial-narrative" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="trial-image-url">URL Imagen</label>
                                    <input type="url" id="trial-image-url" placeholder="URL de la imagen (opcional)">
                                </div>
                                <div class="form-group">
                                    <label for="trial-audio-url">URL Audio</label>
                                    <input type="url" id="trial-audio-url" placeholder="URL del audio (opcional)">
                                </div>
                                <div class="form-group">
                                    <label for="trial-hint-count">N√∫mero de Pistas</label>
                                    <input type="number" id="trial-hint-count" min="0" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="trial-hint-cost">Coste de Pista (Puntos)</label>
                                    <input type="number" id="trial-hint-cost" min="0" value="10" required>
                                </div>
                                <div class="form-group">
                                    <label for="trial-type">Tipo de Prueba</label>
                                    <select id="trial-type" required>
                                        <option value="">Selecciona un tipo</option>
                                        <option value="text">Texto (Pregunta/Respuesta)</option>
                                        <option value="qr">QR (Escaneo de C√≥digo)</option>
                                        <option value="gps">GPS (Ubicaci√≥n Geogr√°fica)</option>
                                        <option value="multiple_choice">M√∫ltiple Opci√≥n</option>
                                        <option value="ordering">Ordenaci√≥n</option>
                                    </select>
                                </div>

                                <div id="text-fields" class="type-field hidden">
                                    <h4>Configuraci√≥n de Prueba de Texto</h4>
                                    <div class="form-group">
                                        <label for="text-question">Pregunta</label>
                                        <input type="text" id="text-question" placeholder="Escribe tu pregunta">
                                    </div>
                                    <div class="form-group">
                                        <label for="text-answer-type">Tipo de Respuesta</label>
                                        <select id="text-answer-type">
                                            <option value="exact">Texto Exacto</option>
                                            <option value="numeric">Num√©rica</option>
                                            <option value="case-insensitive">Texto (Ignorar May√∫s/Min√∫s)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="text-correct-answer">Respuesta Correcta</label>
                                        <input type="text" id="text-correct-answer" placeholder="Respuesta esperada">
                                    </div>
                                </div>

                                <div id="multiple-choice-fields" class="type-field hidden">
                                    <h4>Configuraci√≥n de M√∫ltiple Opci√≥n</h4>
                                    <div class="form-group">
                                        <label for="mc-question">Pregunta</label>
                                        <input type="text" id="mc-question" placeholder="Escribe tu pregunta">
                                    </div>
                                    <div id="mc-options-container">
                                        </div>
                                    <button type="button" class="btn btn-secondary btn-sm" id="add-mc-option-btn">A√±adir Opci√≥n</button>
                                    <div class="form-group">
                                        <label for="mc-correct-answer-index">√çndice de Respuesta Correcta (0-basado)</label>
                                        <input type="number" id="mc-correct-answer-index" min="0" value="0">
                                    </div>
                                </div>

                                <div id="ordering-fields" class="type-field hidden">
                                    <h4>Configuraci√≥n de Ordenaci√≥n</h4>
                                    <p class="help-text">Introduce los elementos en el orden CORRECTO. El juego los mezclar√°.</p>
                                    <div id="ordering-options-container">
                                        </div>
                                    <button type="button" class="btn btn-secondary btn-sm" id="add-ordering-option-btn">A√±adir Elemento</button>
                                </div>

                                <div id="qr-fields" class="type-field hidden">
                                    <h4>Configuraci√≥n de Prueba QR</h4>
                                    <div class="form-group">
                                        <label for="qr-content">Contenido del QR</label>
                                        <input type="text" id="qr-content" placeholder="Texto que debe contener el QR" required>
                                    </div>
                                </div>

                                <div id="gps-fields" class="type-field hidden">
                                    <h4>Configuraci√≥n de Prueba GPS</h4>
                                    <div class="form-group">
                                        <label for="gps-latitude">Latitud</label>
                                        <input type="number" id="gps-latitude" step="any" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="gps-longitude">Longitud</label>
                                        <input type="number" id="gps-longitude" step="any" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="gps-tolerance">Radio de Tolerancia (metros)</label>
                                        <input type="number" id="gps-tolerance" min="1" value="10">
                                        <div id="admin-map" style="height: 200px; width: 100%; margin-top: 10px;"></div>
                                        <button type="button" id="get-current-location-btn" class="btn btn-secondary">Obtener Ubicaci√≥n Actual</button>
                                        <p class="help-text">Haz clic en el mapa para establecer la ubicaci√≥n del GPS o usa tu ubicaci√≥n actual.</p>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Prueba</button>
                                <button type="button" class="btn btn-secondary" id="trial-cancel-btn">Cancelar</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <section id="rankings-section" class="admin-section hidden">
                <h2>Rankings de Juegos</h2>
                <label for="rankings-game-select">Selecciona un Juego:</label>
                <select id="rankings-game-select"></select>
                <div id="rankings-display" class="card-grid">
                    </div>
            </section>
        </main>
    </div>
    <div id="app-alert" class="app-alert"></div>
</body>
<script src="admin-script.js"></script>
</html>